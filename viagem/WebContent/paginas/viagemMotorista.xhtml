<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jstl/core"
	template="/template/geral.xhtml">

	<ui:define name="titulo">Viagem do motorista</ui:define>
	<ui:define name="conteudo">
		<p:messages id="mensagens" closable="true" />

		<h:form id="form1">
			<h3>
				<p:outputLabel value="Viagem do motorista" />
			</h3>


			<p:outputPanel id="viagem"
				rendered="#{viagemMotoristaMb.viagem != null}">
				<p:outputPanel id="novaViagem">
					<!-- rendered="#{viagemMotoristaMb.viagem.status.equals(viagemMotoristaMb.statusViagemPendente)}" -->

					<p:panel header="Sua viagem - #{viagemMotoristaMb.viagem.id}">
						<c:forEach items="#{viagemMotoristaMb.viagem.etapas}" var="etapa">
							<h:panelGrid columns="5">
								<h:outputText value="#{etapa.origem.nome}" />
								<h:outputText value=" X #{etapa.destino.nome}" />
								<h:outputText value=" X #{etapa.entrega.produto}" />
								<h:outputText value="#{etapa.entrega.quantidade}" />
								<h:outputText value="#{etapa.entrega.unidadeQuantidade}" />
							</h:panelGrid>
							<p:commandButton value="Iniciar viagem"
								actionListener="#{viagemMotoristaMb.iniciarViagem}"
								process="@this" update="viagem" />
						</c:forEach>
					</p:panel>
				</p:outputPanel>


				<p:outputPanel id="pontosDaViagem">
					<!-- 
					rendered="#{viagemMotoristaMb.viagem.status != viagemMotoristaMb.statusViagemPendente
					 	and viagemMotoristaMb.pontoViagem == null}">
					 	 -->
					<p:panel header="Seus pontos">
						<c:forEach items="#{viagemMotoristaMb.viagem.pontos}" var="ponto"
							rendered="#{viagemMotoristaMb.viagem != null}">
							<p:panel>
								<h:outputText value="#{ponto.estabelecimento.nome}" />
								<p:commandButton value="Escolher"
									actionListener="#{viagemMotoristaMb.selecionarPonto(ponto)}"
									process="@this" update="viagem" />
							</p:panel>
						</c:forEach>
					</p:panel>
				</p:outputPanel>

				<p:outputPanel id="eventos">
					<!-- 
					rendered="#{viagemMotoristaMb.pontoViagem != null}"> -->
					<p:panel
						header="#{viagemMotoristaMb.pontoViagem.estabelecimento.municipio.nome.concat(' - ')
							.concat(viagemMotoristaMb.pontoViagem.estabelecimento.nome)}">

						<p:panelGrid>
							<h:panelGrid
								rendered="#{viagemMotoristaMb.pontoViagem.dataHoraPrevistaChegada != null}">
								<h:outputText value="A sua última previsão de chegada foi:" />
								<h:outputText
									value="#{viagemMotoristaMb.pontoViagem.dataHoraPrevistaChegada}" />
								<h:outputText
									value="Informe nova previsão de chegada se você acha que mudou:" />
							</h:panelGrid>
							<h:panelGrid>
								<h:outputText value="Informe a previsão de chegada"
									rendered="#{viagemMotoristaMb.pontoViagem.dataHoraPrevistaChegada == null}" />
								<p:calendar pattern="dd/MM/yyyy HH:mm"
									value="#{viagemMotoristaMb.pontoViagem.dataHoraPrevistaChegada}">
								</p:calendar>
								<p:commandButton value="Registrar previsão"
									actionListener="#{viagemMotoristaMb.registrarPrevisaoChegada}"
									update="viagem" />
							</h:panelGrid>
							<p />
							<hr />
							<p />
						</p:panelGrid>
						<h:outputText
							value="Horário de chegada: #{viagemMotoristaMb.pontoViagem.dataHoraChegada}"
							rendered="#{viagemMotoristaMb.pontoViagem.dataHoraChegada != null}" />
						<p:commandButton value="Registrar chegada"
							actionListener="#{viagemMotoristaMb.registrarChegada}"
							update="eventos" />

						<hr />
						<p />

						<p:panel header="Operações">
							<p:dataGrid columns="1"
								value="#{viagemMotoristaMb.pontoViagem.operacoes}"
								var="operacao">

								<h:panelGrid columns="5">
									<h:outputText value="#{operacao.tipo.descricao}" />
									<h:outputText value="#{operacao.etapaEntrega.entrega.produto}" />
									<h:outputText value="#{operacao.etapaEntrega.entrega.quantidade}" />
									<h:outputText value="#{operacao.etapaEntrega.entrega.unidadeQuantidade}" />
								</h:panelGrid>
									<p/>
									<p:selectOneRadio columns="1" value="#{operacao.status}">
										<f:selectItem itemLabel="Realizada" itemValue="#{viagemMotoristaMb.statusOperacaoViagemRealizada}" />
										<f:selectItem itemLabel="Abortada" itemValue="#{viagemMotoristaMb.statusOperacaoViagemAbortada}" />
									</p:selectOneRadio>
							</p:dataGrid>
									<p/>
							<p:commandButton value="Finalizar operações" 
								actionListener="#{viagemMotoristaMb.registrarTerminoOperacoes}"
								update="eventos" />
						</p:panel>
						<hr />
						<p />

						<p:commandButton value="Registrar saída"
							actionListener="#{viagemMotoristaMb.registrarSaida}"
							update="eventos" />

						<hr />
						<p />

					</p:panel>
				</p:outputPanel>
			</p:outputPanel>
		</h:form>
	</ui:define>
</ui:composition>